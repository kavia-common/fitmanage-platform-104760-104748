{"is_source_file": true, "format": "Python", "description": "This file provides subscription management logic for a fitness platform backend, including plan limits, subscription retrieval, limits validation, and a stubbed payment provider for handling subscription-related operations.", "external_files": ["src.models"], "external_methods": ["Session.query", "Session.add", "Session.commit", "Session.refresh", "db.query", "db.query().filter", "db.query().count", "db.query().first"], "published": ["get_plan_limits", "get_active_subscription", "ensure_within_limits_clients", "ensure_within_limits_workout_plans", "ensure_within_limits_diet_plans", "PaymentProviderStub", "payment_provider"], "classes": [{"name": "PlanLimits", "description": "Defines feature and quota limits per subscription plan."}, {"name": "PaymentProviderStub", "description": "A stubbed payment provider for creating, canceling, and verifying subscriptions."}], "methods": [{"name": "PlanLimits get_plan_limits(plan: str)", "description": "Return plan limits by plan id/name.", "scope": "", "scopeKind": ""}, {"name": "Optional[Subscription] get_active_subscription(db: Session, user_id: int)", "description": "Return active subscription for a user, if exists.", "scope": "", "scopeKind": ""}, {"name": "None ensure_within_limits_clients(db: Session, owner: User)", "description": "Validate if owner can create another client according to plan.", "scope": "", "scopeKind": ""}, {"name": "None ensure_within_limits_workout_plans(db: Session, owner_user_id: int, client_id: int)", "description": "Validate workout plan creation limit per client for owner's plan.", "scope": "", "scopeKind": ""}, {"name": "None ensure_within_limits_diet_plans(db: Session, owner_user_id: int, client_id: int)", "description": "Validate diet plan creation limit per client for owner's plan.", "scope": "", "scopeKind": ""}, {"name": "dict create_checkout_session(self, user: User, plan: str)", "description": "Simulate provider checkout session creation and return a fake session link/id.", "scope": "PaymentProviderStub", "scopeKind": "class"}, {"name": "Subscription activate_subscription(self, db: Session, user: User, plan: str)", "description": "Activate a subscription locally as if provider succeeded.", "scope": "PaymentProviderStub", "scopeKind": "class"}, {"name": "None cancel_subscription(self, db: Session, user: User)", "description": "Cancel latest active subscription locally.", "scope": "PaymentProviderStub", "scopeKind": "class"}], "calls": ["db.query(Subscription)", "db.query(Client).filter(Client.user_id == owner.id).count()", "db.query(Client).filter(Client.id == client_id).first()", "db.query(WorkoutPlan).filter(WorkoutPlan.client_id == client_id).count()", "db.query(DietPlan).filter(DietPlan.client_id == client_id).count()", "get_active_subscription(db, owner_user_id)"], "search-terms": ["Subscription limits", "Plan limit retrieval", "Subscription validation", "Stub payment provider", "FastAPI", "SQLAlchemy ORM", "Subscription management", "Free and paid plans"], "state": 2, "file_id": 50, "knowledge_revision": 128, "git_revision": "", "ctags": [{"_type": "tag", "name": "PaymentError", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^class PaymentError(Exception):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PaymentProviderStub", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^class PaymentProviderStub:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PlanLimits", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^class PlanLimits:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "activate_subscription", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^    def activate_subscription(self, db: Session, user: User, plan: str) -> Subscription:$/", "language": "Python", "typeref": "typename:Subscription", "kind": "member", "signature": "(self, db: Session, user: User, plan: str)", "scope": "PaymentProviderStub", "scopeKind": "class"}, {"_type": "tag", "name": "cancel_subscription", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^    def cancel_subscription(self, db: Session, user: User) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "member", "signature": "(self, db: Session, user: User)", "scope": "PaymentProviderStub", "scopeKind": "class"}, {"_type": "tag", "name": "create_checkout_session", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^    def create_checkout_session(self, user: User, plan: str) -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "member", "signature": "(self, user: User, plan: str)", "scope": "PaymentProviderStub", "scopeKind": "class"}, {"_type": "tag", "name": "ensure_within_limits_clients", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^def ensure_within_limits_clients(db: Session, owner: User) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(db: Session, owner: User)"}, {"_type": "tag", "name": "ensure_within_limits_diet_plans", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^def ensure_within_limits_diet_plans(db: Session, owner_user_id: int, client_id: int) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(db: Session, owner_user_id: int, client_id: int)"}, {"_type": "tag", "name": "ensure_within_limits_workout_plans", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^def ensure_within_limits_workout_plans(db: Session, owner_user_id: int, client_id: int) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(db: Session, owner_user_id: int, client_id: int)"}, {"_type": "tag", "name": "get_active_subscription", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^def get_active_subscription(db: Session, user_id: int) -> Optional[Subscription]:$/", "language": "Python", "typeref": "typename:Optional[Subscription]", "kind": "function", "signature": "(db: Session, user_id: int)"}, {"_type": "tag", "name": "get_plan_limits", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^def get_plan_limits(plan: str) -> PlanLimits:$/", "language": "Python", "typeref": "typename:PlanLimits", "kind": "function", "signature": "(plan: str)"}, {"_type": "tag", "name": "payment_provider", "path": "/home/kavia/workspace/code-generation/fitmanage-platform-104760-104748/fitness_nutrition_backend/src/services/subscriptions.py", "pattern": "/^payment_provider = PaymentProviderStub()$/", "language": "Python", "kind": "variable"}], "hash": "f378dab218a0b9f2796e94b967b952c5", "format-version": 4, "code-base-name": "fitness_nutrition_backend", "filename": "fitness_nutrition_backend/src/services/subscriptions.py", "fields": [{"name": "payment_provider = PaymentProviderStub()", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"128": ""}]}